<!doctype html>
<html>
    <head>
        <title>Triangles</title>

        <script>

            function Vector2(x, y){
                this.x = x;
                this.y = y;
            }

            window.onload = main;
            function main(){
                canv = document.getElementById('canv');
                ctx = canv.getContext("2d");
                
                var width = 1920;
                var height = 1080;
                canv.width = width;
                canv.height = height;
                
                var targetVerts = 100;
                var xVerts = Math.round(Math.sqrt((width*targetVerts)/height)) + 0.0;
                var yVerts = Math.round(Math.sqrt((height*targetVerts)/width)) + 0.0;
                var verts = genTessellation(width, height, xVerts, yVerts);

                randomizeTessellation(verts, width, height, xVerts, yVerts);
                drawTriangleFan(verts, xVerts, yVerts);
                drawDebugPoints(verts, xVerts, yVerts);

            }

            function genTessellation(width, height, xVerts, yVerts){
                var verts = new Array(xVerts*yVerts);
                var increment = 0;
                for(var y=0; y<height+1; y+=height/(yVerts-1.0)){
                    for(var x=0; x<width+1; x+=width/(xVerts-1.0)){
                        verts[increment] = new Vector2(x, y);
                        increment++;
                    }
                }
                return(verts);
            }

            function randomizeTessellation(verts, width, height, xVerts, yVerts){
                for(var i=0; i<verts.length; i++){
                    verts[i].x = (verts[i].x - (width/(xVerts-1.0))) + 2*(width/(xVerts-1.0))*Math.random();
                    verts[i].y = (verts[i].y - (height/(yVerts-1.0))) + 2*(height/(yVerts-1.0))*Math.random();
                }
            }

            function drawTriangleFan(verts, xVerts, yVerts){
                for(var i=0; i<verts.length-xVerts; i++){
                    if((i+1)%xVerts == 0) continue;
                    
                    ctx.beginPath();
                    ctx.moveTo(verts[i].x, verts[i].y);
                    ctx.lineTo(verts[i+xVerts].x, verts[i+xVerts].y);
                    ctx.lineTo(verts[i+xVerts+1].x, verts[i+xVerts+1].y);
                    ctx.fillStyle = "#6699CC"
                    ctx.fill();

                    ctx.beginPath();
                    ctx.moveTo(verts[i].x, verts[i].y);
                    ctx.lineTo(verts[i+1].x, verts[i+1].y);
                    ctx.lineTo(verts[i+xVerts+1].x, verts[i+xVerts+1].y);
                    ctx.fillStyle = "#CC9966"
                    ctx.fill();
                }
            }

            function drawDebugPoints(verts, xVerts, yVerts){
                ctx.fillStyle = "#000000"
                for(var i=0; i<verts.length; i++){
                    ctx.beginPath();
                    ctx.arc(verts[i].x, verts[i].y, 2, 0, 2*Math.PI);
                    ctx.fill();
                }
            }


        </script>
    </head>

    <body>
        <canvas id="canv">Canvas failed to load.</canvas>

    </body>
</html>
